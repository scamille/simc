# This script is used by the Travis-CI (continuous integration) testing
language: cpp

sudo: false

dist: focal

arch:
  - arm64
  - arm64-graviton2
  - ppc64le
  - s390x

os:
  - linux

# addons:
#   apt:
#     sources: 
#     - sourceline: 'deb http://apt.llvm.org/focal/ llvm-toolchain-focal-10 main'
#       key_url: 'https://apt.llvm.org/llvm-snapshot.gpg.key'
#     packages:
#     - cmake
#     - libcurl4-openssl-dev
#     - ninja-build
#     - lld
#     - clang-10
#     - lld-10


compiler:
#  - gcc
  - clang

before_install:
  - wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key|sudo apt-key add -
  - sudo add-apt-repository -y 'deb http://apt.llvm.org/focal/ llvm-toolchain-focal-10 main'
  - sudo apt-get update
  - sudo apt-get -y install cmake libcurl4-openssl-dev ninja-build clang-10 lld

install: 
  - cmake -H. -B'./build' -GNinja
      -DBUILD_GUI=OFF
      -DCMAKE_BUILD_TYPE=Debug
      -DCMAKE_CXX_COMPILER=clang++-10 -DCMAKE_C_COMPILER=clang-10
      -DCMAKE_CXX_FLAGS="
        -fno-omit-frame-pointer -fsanitize=address,undefined"
      -DCMAKE_EXE_LINKER_FLAGS="-fuse-ld=lld -fsanitize=address,undefined"
  - ninja -C './build' -j2

script:
  - ./build/simc CI.simc iterations=10 fight_style=DungeonSlice output=/dev/null html=/dev/null json2=/dev/null cleanup_threads=1
